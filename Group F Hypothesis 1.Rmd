---
title: "R Notebook"
author: "Group F - Meichen Zhou"
output: pdf_document
---

Hypothesis 1 Testing

HA: The net latitudinal range of species in the Anopheles subgenus is increasing from 1898 to 2016 in Africa.
H0: The average absolute latitudinal range of species in the Anopheles subgenus is not changing from 1898 to 2016 in Africa.

Prediction: We predict that there may be changes to the average, minimal and maximal latitudes
where the Anopheline malaria vector species is observed. In this case, net latitudinal range indicates an expansion in both directions from the equator. Anopheline mosquitoes are the main vectors for malaria transmission, and we expect that these mosquitoes will expand their range (represented by net latitudinal range), as observed by their presence in more areas across Africa. We predict this given the documented history of Malaria cases in the African continent increasing over the years (Fact Sheet about Malaria, 2022).


Data Analysis Plan: Paired t-tests will be used to test hypothesis 1. The observed latitudes at the earliest and the latest time points for each species will be compared by these tests, and the corresponding p-values will provide evidence towards or against the null hypothesis (as the paired t-tests will examine whether the mean difference between pairs of measurements is zero or not). 

Install Basic Library
```{r}
library(tidyverse)
library(readr)
library(knitr)
library(ggpubr)
library(PairedData)
```

Read in original csv data
```{r}
data <- read.csv("C:/Users/sarah/Downloads/species_dataset.csv")
```

Data Restructure
- filter out all of the NAs
- select columns needed
- group by species. 24 different species in total in Africa
- filter out the first/last five year's latitude data for each species
- record the min and the max of the latitude in the five year period
- tally to see

```{r}
earliest_data = data %>% 
  filter(!is.na(Lat)) %>% 
  dplyr::select(Lat,YeStart,Complex,Species,Sub_Specices) %>% 
  group_by(Complex,Species,Sub_Specices) %>% 
  filter(YeStart>=min(YeStart),YeStart<=min(YeStart)+5) %>% 
  mutate(Earliest_Year = min(YeStart),Earliest_Lat_min = min(Lat),Earliest_Lat_Max = max(Lat))%>%
  group_by(Complex,Species,Sub_Specices,Earliest_Year,Earliest_Lat_min,Earliest_Lat_Max) %>%
  tally()
```

```{r}
lastest_data = data %>% 
  filter(!is.na(Lat)) %>% 
  dplyr::select(Lat,YeStart,Complex,Species,Sub_Specices) %>% 
  group_by(Complex,Species,Sub_Specices) %>% 
  filter(YeStart<=max(YeStart),YeStart>=max(YeStart)-5) %>% 
  mutate(Lastest_Year = max(YeStart),Lastest_Lat_min = min(Lat),Lastest_Lat_Max = max(Lat))%>%
  group_by(Complex,Species,Sub_Specices,Lastest_Year,Lastest_Lat_min,Lastest_Lat_Max) %>%
  tally()
```

Merge two datasets together
```{r}
wow = merge(earliest_data,lastest_data, by=c("Complex","Species","Sub_Specices"))
wow = wow %>% dplyr::select(-n.x,-n.y)
```

Calculate the net latitudianl range for the first/last five year
```{r}
paired_data = wow %>% 
  mutate(Earliest_Range = abs(Earliest_Lat_Max - Earliest_Lat_min)) %>% 
  mutate(Lastest_Range = abs(Lastest_Lat_Max - Lastest_Lat_min)) %>% 
  mutate(Species_2 = case_when(Sub_Specices == "SS.M.Form" ~ "An gambiae ss (M Form)",
                               Sub_Specices == "SS.S.Form" ~ "An gambiae ss (S Form)",
                               Sub_Specices == "Unspecified Sub Species" ~ "An gambiae ss (Unspecified Sub Species)",
                               Sub_Specices == NA ~ Species,
                               1 == 1 ~ Species)) %>% 
  dplyr::select(c(Species_2, Earliest_Range, Lastest_Range))

#Create a figure
table <- kable(paired_data, col.names = c("Species", "Earliest Range", "Latest Range"), caption = "Earliest and Latest Ranges of Anopheles Sub Species")
```

Test normality
```{r}
shapiro.test(paired_data$Earliest_Range)
shapiro.test(paired_data$Lastest_Range)
```

Result:
Earliest_Range:Almost PASS p=0.049
Lastest_Range:PASS

Test Variance
```{r}
var.test(paired_data$Earliest_Range, paired_data$Lastest_Range)
help(var.test)
```

Paired t-test
```{r}
t.test(paired_data$Earliest_Range,paired_data$Lastest_Range,paried = TRUE)
```
Plot the change in RANGE to see the trend

3 out of 24 are decreasing
21 out of 24 are increasing
```{r}
pd <- paired(paired_data$Earliest_Range,paired_data$Lastest_Range)
colnames(pd) <- c("Earliest Range","Lastest Range")
head(pd)

ggpaired(pd,
         cond1 = "Earliest Range",
         cond2 = "Lastest Range",
         fill = "condition",
         palette = "jco",
         title = "Figure 1: Comparison of Anopheles Species Range during \n First and Last Observed Period",
         xlab = FALSE,
         ylab = "Range (Degrees)")
```










































